var canvas={scale:100,width_canvas:700,height_canvas:400,canvas:null,context:null,thumbnail:null,title_project:"nowa mapa",context_x:0,context_y:0,context_new_x:0,context_new_y:0,offset_left:null,offset_top:null,active_row:null,active_column:null,thumbnail:function(){var a=document.getElementById("main_canvas"),t=a.toDataURL();console.log(t)},draw:function(){this.clear(),pointers.create_array(),pointers.draw(),void 0!==image.obj&&image.draw()},draw_thumnail:function(){canvas.canvas=document.getElementById("thumbnail_canvas"),canvas.thumbnail=document.getElementById("thumbnail_canvas"),canvas.context=canvas.canvas.getContext("2d"),this.clear(),pointers.create_array(),pointers.draw(),canvas.canvas=document.getElementById("main_canvas"),canvas.context=canvas.canvas.getContext("2d")},reset:function(){this.context.setTransform(1,0,0,1,0,0),canvas.context.scale(canvas.scale/100,canvas.scale/100)},clear:function(){this.context.clearRect(0,0,this.width_canvas,this.height_canvas)},resize_width:function(a){this.width_canvas=a,$("#main_canvas").attr("width",this.width_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({width:this.width_canvas+"px"}),$("#canvas_info #width").val(this.width_canvas+"px"),this.scale=100,$("#canvas_info #size").val(this.scale+"%"),menu_top.show_info()},resize_height:function(a){this.height_canvas=a,$("#main_canvas").attr("height",this.height_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({height:this.height_canvas+"px"}),$("#canvas_info #height").val(this.height_canvas+"px"),this.scale=100,$("#canvas_info #size").val(this.scale+"%"),menu_top.show_info()},set_default:function(){$("#canvas_box #right_resize, #canvas_box #bottom_resize").fadeIn(500),this.move_image&&$("#canvas_box #image_resize").fadeIn(0),canvas.scale=100,canvas.context_x=0,canvas.context_y=0,context_new_x=0,context_new_y=0,canvas.context.scale(canvas.scale/100,canvas.scale/100);var a=canvas.width_canvas*(canvas.scale/100),t=canvas.height_canvas*(canvas.scale/100);$("#main_canvas").attr({width:a+"px",height:t+"px"}),$("#canvas_box, #canvas_wrapper").css({width:a+"px",height:t+"px"}),canvas.reset(),canvas.context.translate(canvas.context_x/(canvas.scale/100),canvas.context_y/(canvas.scale/100)),canvas.draw(),menu_top.show_info(),canvas.draw()}},categories={category:new Array(["gumuj","#808080"]),add:function(){var a=Array($('#category_box input[name="add_category"]').val(),"#ff0000");$('#category_box input[name="add_category"]').val(""),this.category.push(a),menu_top.category=this.category.length-1,this.show_list()},update:function(a,t){this.category[a][0]=t,this.show_list()},remove:function(a){var t=this;$.each(this.category,function(n,e){n>=a&&(t.category[n]=t.category[n+1])});for(var n=0;n<pointers.pointers.length;n++)for(var e=0;e<pointers.pointers[n].length;e++)pointers.pointers[n][e]==a&&(pointers.pointers[n][e]=0),pointers.pointers[n][e]>a&&(pointers.pointers[n][e]=parseInt(pointers.pointers[n][e])-1);this.category.pop(),this.show_list(),canvas.draw()},show_list:function(){for(var a="<table>",t="",n=this.category.length;n>1;n--)a+="<tr><td><span>"+(n-1)+'</span></td><td><input type="text" name="category_name" id_category="'+(n-1)+'" value="'+this.category[n-1][0]+'" /></td><td><div class="colorpicker_box" style="background-color:'+this.category[n-1][1]+'" id_category="'+(n-1)+'"></div></td><td><button class="remove" id_category="'+(n-1)+'">usun</button></td></tr>',t+='<option name="'+(n-1)+'">'+this.category[n-1][0]+"</option>";t+=0==menu_top.category?'<option selected name="0">'+this.category[0][0]+"</option>":'<option name="0">'+this.category[0][0]+"</option>",a+="</table>",$("#category_box #list").html(a),$("select#change_category").html(t),colorpicker.add()}},colorpicker={click_id:null,add:function(){this.remove(),$(".colorpicker_box").ColorPicker({color:"#ff0000",onShow:function(a){return"none"==$(a).css("display")&&($(a).fadeIn(200),colorpicker.click_id=$(this).attr("id_category")),!1},onHide:function(a){return $(a).fadeOut(200),!1},onChange:function(a,t,n){$('.colorpicker_box[id_category="'+colorpicker.click_id+'"]').css("backgroundColor","#"+t),categories.category[colorpicker.click_id][1]="#"+t,canvas.draw()}})},remove:function(){$(".colorpicker").remove()}},crud={map_json:Array(),map_hash:null,select_map:function(a){"new_map"==a?this.create_map():(this.map_hash=a,this.get_map())},duplicate:function(){canvas.title_project=canvas.title_project+" - kopia",this.get_data();var a=this;({map_json:a.map_json});jQuery.ajax({url:"api/maps",data:{map_json:a.map_json},type:"POST",success:function(t){a.map_hash=t.hash_map,alert("zapisano nową mapę"),location.reload()}})},get_data:function(){this.map_json=Array(),this.map_json[0]=Array(),this.map_json[0][0]=canvas.height_canvas,this.map_json[0][1]=canvas.width_canvas,this.map_json[0][2]=pointers.padding_x,this.map_json[0][3]=pointers.padding_y,this.map_json[0][4]=pointers.translate_modulo,this.map_json[0][5]=pointers.size_pointer,this.map_json[0][6]=pointers.main_kind,this.map_json[0][7]=canvas.title_project,this.map_json[1]=pointers.pointers,this.map_json[2]=categories.category,this.map_json[3]=Array(),image.obj&&(this.map_json[3][0]=image.obj.src,this.map_json[3][1]=image.x,this.map_json[3][2]=image.y,this.map_json[3][3]=image.width,this.map_json[3][4]=image.height,this.map_json[3][5]=image.alpha),this.map_json=JSON.stringify(this.map_json)},special:function(){var a=crud.data;canvas.height_canvas=a[0][0],canvas.width_canvas=a[0][1],pointers.padding_x=a[0][2],pointers.padding_y=a[0][3],pointers.translate_modulo=a[0][4],pointers.size_pointer=a[0][5],pointers.main_kind=a[0][6],canvas.title_project=a[0][7],$('#pointer_box input[name="padding_x"]').val(a[0][2]),$('#pointer_box input[name="padding_y"]').val(a[0][3]),$('#pointer_box input[name="size_pointer"]').val(a[0][5]),$('input[name="title_project"]').val(a[0][7]),a[0][4]&&($('#pointer_box div[name="translate_modulo"]').removeClass("switch-off"),$('#pointer_box div[name="translate_modulo"]').addClass("switch-on")),$('#pointer_box select[name="main_kind"]').html(""),pointers.kinds.forEach(function(t){t==a[0][6]?$('#pointer_box select[name="main_kind"]').append('<option selected="selected" name="'+t+'">'+t+"</option>"):$('#pointer_box select[name="main_kind"]').append('<option name="'+t+'">'+t+"</option>")}),pointers.pointers=a[1],categories.category=a[2],a[3].length>2&&(image.obj=new Image,image.obj.src=a[3][0],image.x=parseInt(a[3][1]),image.y=parseInt(a[3][2]),image.width=parseInt(a[3][3]),image.height=parseInt(a[3][4]),image.alpha=parseInt(a[3][5]),$('#alpha_image option[name="'+image.alpha+'"]').attr("selected",!0),image.obj.onload=function(){canvas.draw()}),$("#main_canvas").attr("width",canvas.width_canvas+"px"),$("#main_canvas").attr("height",canvas.height_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({width:canvas.width_canvas+"px",height:canvas.height_canvas+"px"}),canvas.draw(),categories.show_list()},get_map:function(){var a=this;$.ajax({url:"/api/map/"+a.map_hash,type:"GET",contentType:"application/json"}).done(function(a){var t=JSON.parse(a.data[0].map_json);canvas.height_canvas=t[0][0],canvas.width_canvas=t[0][1],pointers.padding_x=t[0][2],pointers.padding_y=t[0][3],pointers.translate_modulo=t[0][4],pointers.size_pointer=t[0][5],pointers.main_kind=t[0][6],canvas.title_project=t[0][7],$('#pointer_box input[name="padding_x"]').val(t[0][2]),$('#pointer_box input[name="padding_y"]').val(t[0][3]),$('#pointer_box input[name="size_pointer"]').val(t[0][5]),$('input[name="title_project"]').val(t[0][7]),t[0][4]&&($('#pointer_box div[name="translate_modulo"]').removeClass("switch-off"),$('#pointer_box div[name="translate_modulo"]').addClass("switch-on")),$('#pointer_box select[name="main_kind"]').html(""),pointers.kinds.forEach(function(a){a==t[0][6]?$('#pointer_box select[name="main_kind"]').append('<option selected="selected" name="'+a+'">'+a+"</option>"):$('#pointer_box select[name="main_kind"]').append('<option name="'+a+'">'+a+"</option>")}),pointers.pointers=t[1],categories.category=t[2],t[3].length>2&&(image.obj=new Image,image.obj.src=t[3][0],image.x=parseInt(t[3][1]),image.y=parseInt(t[3][2]),image.width=parseInt(t[3][3]),image.height=parseInt(t[3][4]),image.alpha=parseInt(t[3][5]),$('#alpha_image option[name="'+image.alpha+'"]').attr("selected",!0),image.obj.onload=function(){canvas.draw()}),$("#main_canvas").attr("width",canvas.width_canvas+"px"),$("#main_canvas").attr("height",canvas.height_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({width:canvas.width_canvas+"px",height:canvas.height_canvas+"px"}),canvas.draw(),categories.show_list()})},create_map:function(){this.get_data();var a=this;({map_json:a.map_json});jQuery.ajax({url:"api/maps",data:{map_json:a.map_json},type:"POST",success:function(t){a.map_hash=t.hash_map,alert("zapisano nową mapę"),menu_top.get_maps()}})},update_map:function(){this.get_data();var a=this,t={map_hash:a.map_hash,map_json:a.map_json};jQuery.ajax({url:"api/maps",data:t,type:"PUT",success:function(a){alert("zaktualizowano mapę")}})},delete_map:function(){var a=this;null!=this.map_hash?jQuery.ajax({url:"api/map/"+a.map_hash,type:"DELETE",success:function(a){"ok"==a.status?location.reload():alert("błąd podczas usuwania")}}):alert("brak identyfikatora projektu")}},figures={square:function(a,t,n){canvas.context.fillRect(a,t,n,n)},circle:function(a,t,n){var n=n/2,e=a+n,s=t+n;canvas.context.beginPath(),canvas.context.arc(e,s,n,0,2*Math.PI),canvas.context.fill()},hexagon:function(a,t,n){var e=n/4,s=n/2,i=n/2*Math.sqrt(3)/2;canvas.context.beginPath(),canvas.context.moveTo(a,t+s),canvas.context.lineTo(a+e,t+s-i),canvas.context.lineTo(a+e+s,t+s-i),canvas.context.lineTo(a+n,t+s),canvas.context.lineTo(a+n-e,t+s+i),canvas.context.lineTo(a+e,t+s+i),canvas.context.lineTo(a,t+s),canvas.context.fill()},hexagon2:function(a,t,n){var e=n/4,s=n/2,i=n/2*Math.sqrt(3)/2;canvas.context.beginPath(),canvas.context.moveTo(a+s,t),canvas.context.lineTo(a+s+i,t+e),canvas.context.lineTo(a+s+i,t+s+e),canvas.context.lineTo(a+s,t+n),canvas.context.lineTo(a+s-i,t+s+e),canvas.context.lineTo(a+s-i,t+e),canvas.context.lineTo(a+s,t),canvas.context.fill()}},global={toogle_panel:function(a){a||(a=window.event),"0px"==$(a.target).parent().css("right")?$(a.target).parent().animate({right:[-$(a.target).parent().width()-20,"swing"]},1e3,function(){}):$(a.target).parent().animate({right:["0px","swing"]},1e3,function(){})}},image={obj:void 0,x:null,y:null,width:null,height:null,alpha:10,draw:function(){canvas.context.globalAlpha=this.alpha/10,canvas.context.drawImage(this.obj,this.x,this.y,this.width,this.height),$("#canvas_box #image_resize").css({height:this.height,top:this.y+"px",left:this.x+this.width+"px"}),canvas.context.globalAlpha=1},dataURItoBlob:function(a){for(var t=atob(a.split(",")[1]),n=[],e=0;e<t.length;e++)n.push(t.charCodeAt(e));return new Blob([new Uint8Array(n)],{type:"image/png"})}},data_input={get:function(){map.name=$('#map_form input[name="name"]').val(),map.path=$("#map_form textarea").val().replace(/"/g,"'"),$("#map_contener").html($("textarea[name=map_path]").val())},set:function(){$('#map_form input[name="name"]').val(map.name),$("#map_form textarea").val(map.path),$("#map_contener").html($("textarea[name=map_path]").val())}};$(document).ready(function(){menu_top.get_maps(),$(document).on("focusin","input",function(){menu_top.disable_select=!0}),$(document).on("focusout","input",function(){menu_top.disable_select=!1}),$("#toolbar_top button.save").click(function(){console.log("crud",crud.map_hash),"string"==typeof crud.map_hash?crud.update_map():crud.create_map()}),$("#toolbar_top button.delete").click(function(){confirm("Czy chcesz usunąć mapę ?")&&"string"==typeof crud.map_hash&&crud.delete_map()}),$("#change_category").change(function(){$("#change_category").blur()}),$(document).mouseup(function(){mouse.mouse_down=!1}),$(document).mousedown(function(a){a||(a=window.event),mouse.set_mouse_down(a)}),$(document).mousemove(function(a){a||(a=window.event),mouse.set_position(a),mouse.mouse_down&&mouse.mousemove(a),menu_top.auto_draw&&(mouse.click_obj="canvas",mouse.mousemove(a))}),$("#main_canvas").mousedown(function(a){a||(a=window.event),mouse.set_mouse_down(a),mouse.set_position(a),mouse.mousemove(a)}),$(document).mouseup(function(){pointers.last_column=null,pointers.last_row=null,canvas.context_x=canvas.context_new_x,canvas.context_y=canvas.context_new_y}),$("#add_category").click(function(){categories.add()}),$('input[name="add_category"]').keypress(function(a){13==a.which&&categories.add()}),$(document).keypress(function(a){menu_top.switch_mode(a.which)}),$("#list").delegate("input","focusout",function(){categories.update($(this).attr("id_category"),$(this).val())}),$("#list").delegate("input","keypress",function(a){13==a.which&&categories.update($(this).attr("id_category"),$(this).val())}),$("#list").delegate("button.remove","click",function(){categories.remove($(this).attr("id_category"))}),$("#list").delegate("input","click",function(){menu_top.mode_key=!1}),$("#list").delegate("input","focusout",function(){menu_top.mode_key=!0}),$("#category_box h2, #pointer_box h2").click(function(a){global.toogle_panel(a)}),$("button.increment").click(function(){models.button_increment($(this))}),$("button.decrement").click(function(){models.button_decrement($(this))}),$(".switch").click(function(){models.update_from_switch($(this))}),$(".input_base").change(function(){models.update_from_input($(this))}),$(".input_base_text").change(function(){models.update_from_input_text($(this))}),$(".select_base").change(function(){models.update_from_select($(this))}),$("#menu_top #increment_canvas").click(function(){menu_top.increment_scale()}),$("#menu_top #decrement_canvas").click(function(){menu_top.decrement_scale()}),$("#menu_top #add_image").click(function(){menu_top.add_image()}),$("#menu_top #reset_canvas").click(function(){canvas.set_default()}),$("#duplicate").click(function(){confirm("czy chcesz skopiować aktualną mapę ? ?")&&crud.duplicate()}),canvas.canvas=document.getElementById("main_canvas"),canvas.context=canvas.canvas.getContext("2d"),canvas.width_canvas=parseInt($("#main_canvas").attr("width")),canvas.height_canvas=parseInt($("#main_canvas").attr("height"));var a=$("#canvas_box").offset();canvas.offset_left=a.left,canvas.offset_top=a.top,pointers.create_array(),$("#canvas_info #width").val(canvas.width_canvas+"px"),$("#canvas_info #height").val(canvas.height_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({width:canvas.width_canvas+"px",height:canvas.height_canvas+"px"}),$("#canvas_info #width,#canvas_info #height,#canvas_info #size").change(function(){menu_top.update_canvas_info()}),$("#alpha_image").change(function(){menu_top.change_alpha()}),$("input").click(function(){menu_top.mode_key=!1}),$("input").focusout(function(){menu_top.mode_key=!0}),$(document).mouseup(function(){canvas.draw()}),canvas.draw(),$(".menu_right .save").click(function(){null==crud.map_hash?crud.create_map():crud.update_map()}),$(".menu_right .remove").click(function(){confirm("czy napewno usunąć mapę ?")&&crud.delete_map()})});var menu_top={move_image:!1,move_canvas:!1,auto_draw:!1,mode_key:!0,category:0,disable_select:!1,get_maps:function(){$.ajax({url:"/api/maps",type:"GET",contentType:"application/json"}).done(function(a){if("ok"==a.status){for(var t="",n=0,e=a.data.length;n<e;n++)console.log(JSON.parse(a.data[n].map_json)[0][7]),t+=a.data[n]._id==crud.map_hash?'<option selected id="'+a.data[n]._id+'">'+JSON.parse(a.data[n].map_json)[0][7]+"</option>":'<option id="'+a.data[n]._id+'">'+JSON.parse(a.data[n].map_json)[0][7]+"</option>";$("#toolbar_top select.select_maps").append(t)}}),$(".select_maps").change(function(){confirm("Czy chcesz wczytać nową mapę ?")&&("new_map"==$(this).find("option:selected").attr("id")?location.reload():crud.select_map($(this).find("option:selected").attr("id")))})},update_canvas_info:function(){canvas.scale=parseInt($("#canvas_info #size").val()),canvas.width_canvas=parseInt($("#canvas_info #width").val()),canvas.height_canvas=parseInt($("#canvas_info #height").val()),$("#canvas_info #size").val(canvas.scale+"%"),$("#canvas_info #width").val(canvas.width_canvas+"px"),$("#canvas_info #height").val(canvas.height_canvas+"px"),$("#canvas_box, #canvas_wrapper").css({width:canvas.width_canvas+"px",height:canvas.height_canvas+"px"}),$("#canvas_box #main_canvas").attr("width",canvas.width_canvas+"px"),$("#canvas_box #main_canvas").attr("height",canvas.height_canvas+"px"),canvas.draw()},change_alpha:function(){image.alpha=$("#alpha_image").find("option:selected").attr("name"),canvas.draw()},add_image:function(){var a=prompt("Podaj ścieżkę do zdjęcia: ");a&&a.length>0&&(image.obj=new Image,image.obj.onload=function(){image.width=image.obj.width,image.height=image.obj.height,image.draw()},image.x=0,image.y=0,image.obj.src=a)},show_info:function(){$("#canvas_info #size").val(parseInt(canvas.scale)+"%"),$("#canvas_info #width").val(parseInt(canvas.width_canvas)+"px"),$("#canvas_info #height").val(parseInt(canvas.height_canvas)+"px")},increment_scale:function(){canvas.reset(),canvas.scale+=5,100==canvas.scale?($("#canvas_box #right_resize, #canvas_box #bottom_resize").fadeIn(500),this.move_image&&$("#canvas_box #image_resize").fadeIn(0)):($("#canvas_box #right_resize, #canvas_box #bottom_resize").fadeOut(500),$("#canvas_box #image_resize").fadeOut(0));var a=canvas.width_canvas*(canvas.scale/100),t=canvas.height_canvas*(canvas.scale/100);$("#main_canvas").attr({width:a+"px",height:t+"px"}),$("#canvas_box, #canvas_wrapper").css({width:a+"px",height:t+"px"}),canvas.context.scale(canvas.scale/100,canvas.scale/100),canvas.context.translate(canvas.context_x/(canvas.scale/100),canvas.context_y/(canvas.scale/100)),this.show_info(),canvas.draw()},decrement_scale:function(){if(canvas.scale>100){canvas.reset(),canvas.scale-=5,100==canvas.scale?($("#canvas_box #right_resize, #canvas_box #bottom_resize").fadeIn(500),this.move_image&&$("#canvas_box #image_resize").fadeIn(0)):($("#canvas_box #right_resize, #canvas_box #bottom_resize").fadeOut(500),$("#canvas_box #image_resize").fadeOut(0));var a=canvas.width_canvas*(canvas.scale/100),t=canvas.height_canvas*(canvas.scale/100);$("#main_canvas").attr({width:a+"px",height:t+"px"}),$("#canvas_box, #canvas_wrapper").css({width:a+"px",height:t+"px"}),canvas.context.scale(canvas.scale/100,canvas.scale/100),canvas.context.translate(canvas.context_x/(canvas.scale/100),canvas.context_y/(canvas.scale/100)),this.show_info(),canvas.draw()}},switch_mode:function(a){if(!this.disable_select&&this.mode_key)switch(a){case 105:image.obj&&(this.move_image?(this.move_image=!1,$("#menu_top div#move_image").css("background","#aaa"),$("#canvas_wrapper #image_resize").hide()):(this.move_image=!0,this.auto_draw=!1,this.move_canvas=!1,$("#menu_top div#move_image").css("background","#34a81c"),$("#menu_top div#auto_draw").css("background","#aaa"),$("#menu_top div#move_canvas").css("background","#aaa"),$("#canvas_wrapper #image_resize").show()));break;case 100:pointers.last_row=null,pointers.last_column=null,this.auto_draw?(this.auto_draw=!1,$("#menu_top div#auto_draw").css("background","#aaa")):(this.auto_draw=!0,this.move_canvas=!1,this.move_image=!1,$("#menu_top div#move_canvas").css("background","#aaa"),$("#menu_top div#move_image").css("background","#aaa"),$("#menu_top div#auto_draw").css("background","#34a81c"));break;case 99:this.move_canvas?(this.move_canvas=!1,$("#menu_top div#move_canvas").css("background","#aaa")):(this.move_canvas=!0,this.move_image=!1,this.auto_draw=!1,$("#menu_top div#move_canvas").css("background","#34a81c"),$("#menu_top div#move_image").css("background","#aaa"),$("#menu_top div#auto_draw").css("background","#aaa"))}}},models={button_increment:function(a){var t=$(a).attr("nameinput"),n=parseInt($('input[name="'+t+'"]').val())+1;$('input[name="'+t+'"]').val(n),this.update_from_input($('input[name="'+t+'"]'))},button_decrement:function(a){var t=$(a).attr("nameinput"),n=parseInt($('input[name="'+t+'"]').val())-1;$('input[name="'+t+'"]').val(n),this.update_from_input($('input[name="'+t+'"]'))},update_from_input:function(a){var t=$(a).attr("obj"),n=$(a).attr("name");window[t][n]=parseInt($(a).val()),canvas.draw()},update_from_input_text:function(a){var t=$(a).attr("obj"),n=$(a).attr("name");window[t][n]=$(a).val(),canvas.draw()},update_from_select:function(a){var t=$(a).attr("obj"),n=$(a).attr("name");window[t][n]=$(a).find("option:selected").attr("name"),canvas.draw()},update_from_switch:function(a){var t=$(a).attr("obj"),n=$(a).attr("name");"false"==$(a).attr("value")?($(a).attr("value","true"),$(a).removeClass("switch-off"),$(a).addClass("switch-on"),window[t][n]=!0):($(a).attr("value","false"),$(a).removeClass("switch-on"),$(a).addClass("switch-off"),window[t][n]=!1),canvas.draw()}},mouse={mouse_down:!1,click_obj:null,tmp_mouse_x:null,tmp_mouse_y:null,left:null,top:null,padding_x:null,padding_y:null,offset_x:null,offset_y:null,set_mouse_down:function(a){a||(a=window.event);var t=a.target;if("undefined"!=typeof $(a.target).attr("nameclick")){this.click_obj=$(a.target).attr("nameclick");var n=$(t).offset();this.offset_x=n.left,this.offset_y=n.top,this.padding_x=this.left-n.left,this.padding_y=this.top-n.top,this.mouse_down=!0,this.tmp_mouse_x=image.x,this.tmp_mouse_y=image.y}},set_position:function(a){this.left=a.pageX,this.top=a.pageY},mousemove:function(){switch(this.click_obj){case"right_resize":var a=$("#canvas_box #canvas_wrapper").children("canvas").offset(),t=this.left-this.padding_x-a.left;t<screen.width-100&&canvas.resize_width(t);break;case"bottom_resize":var a=$("#canvas_box #canvas_wrapper").children("canvas").offset();canvas.resize_height(this.top-this.padding_y-a.top);break;case"image_resize":if(void 0!==image.obj){var a=$("#canvas_box #canvas_wrapper").children("canvas").offset(),n=this.left-a.left,e=image.x+image.width-n+this.padding_x,s=image.width/image.height;image.width-e>100&&(image.width-=e,image.height-=e/s,canvas.draw())}break;case"canvas":if(menu_top.move_image&&void 0!==image.obj){var a=$("#canvas_box #canvas_wrapper").children("canvas").offset(),n=this.left-a.left,i=this.top-a.top,o=n-this.padding_x+mouse.tmp_mouse_x,c=i-this.padding_y+mouse.tmp_mouse_y,r=o,_=c;image.x=r,image.y=_,canvas.draw()}else if(menu_top.move_image||menu_top.move_canvas)menu_top.move_canvas&&(canvas.reset(),canvas.clear(),canvas.context_new_x=mouse.left-mouse.offset_x-mouse.padding_x+canvas.context_x,canvas.context_new_y=mouse.top-mouse.offset_y-mouse.padding_y+canvas.context_y,canvas.context_new_x>0&&(canvas.context_new_x=0),canvas.context_new_y>0&&(canvas.context_new_y=0),canvas.context.translate(canvas.context_new_x/(canvas.scale/100),canvas.context_new_y/(canvas.scale/100)),canvas.draw());else{var p=parseInt((this.top-canvas.offset_top+canvas.context_y*-1)/((pointers.size_pointer+pointers.padding_y)*(canvas.scale/100))),v=parseInt((this.left-canvas.offset_left+canvas.context_x*-1)/((pointers.size_pointer+pointers.padding_x)*(canvas.scale/100)));pointers.translate_modulo&&p%2==0&&(v=parseInt((this.left-canvas.offset_left+canvas.context_x*-1-pointers.size_pointer/2)/((pointers.size_pointer+pointers.padding_x)*(canvas.scale/100)))),p>=0&&p<canvas.active_row&&v>=0&&v<canvas.active_column?(pointers.update_point(p,v,pointers.last_row,pointers.last_column),pointers.last_column=v,pointers.last_row=p,canvas.draw()):(pointers.last_row=null,pointers.last_column=null)}}}},pointers={show_all_point:!0,padding_x:1,padding_y:1,translate_modulo:!1,size_pointer:10,main_kind:"square",kinds:Array("square","circle","hexagon","hexagon2"),pointers:Array(),last_column:null,last_row:null,draw:function(){var a=this.size_pointer+this.padding_x,t=this.size_pointer+this.padding_y,n="rgba(0,0,0,0)";this.show_all_point&&(n="rgba(128,128,128,1)");for(var e=0;e<canvas.active_row;e++)for(var s=0;s<canvas.active_column;s++){if(0==this.pointers[e][s])canvas.context.fillStyle=n,canvas.context.globalAlpha=.5;else{this.pointers[e][s]!=menu_top.category&&0!=menu_top.category?canvas.context.globalAlpha=.2:canvas.context.globalAlpha=1;try{canvas.context.fillStyle=categories.category[this.pointers[e][s]][1]}catch(i){console.log("ERROR 39 LINE ! ",this.pointers[e][s],e,s)}}e%2==0&&pointers.translate_modulo?window.figures[this.main_kind](s*a+a/2,e*t,this.size_pointer):window.figures[this.main_kind](s*a,e*t,this.size_pointer)}},create_array:function(){if(canvas.active_row=parseInt(canvas.height_canvas/(pointers.size_pointer+pointers.padding_y)),canvas.active_column=parseInt(canvas.width_canvas/(pointers.size_pointer+pointers.padding_x)),this.pointers.length<canvas.active_row||this.pointers[0].length<canvas.active_column)for(var a=0;a<canvas.active_row;a++)for(var t=0;t<canvas.active_column;t++)void 0==this.pointers[a]&&(this.pointers[a]=new Array),void 0==this.pointers[a][t]&&(this.pointers[a][t]=0)},update_point:function(a,t,n,e){if(this.pointers[a][t]=parseInt(menu_top.category),n==a&&e==t||null==n||null==e)this.pointers[a][t]=parseInt(menu_top.category);else{var s=(n-a)/(e-t),i=a-s*t;if(e>t)var o=t,c=e;else var c=t,o=e;if(n>a)var r=a,_=n;else var _=a,r=n;for(var p=null,v=o;v<=c;v++)p=parseInt(s*v+i),$.isNumeric(p)||(p=a),this.pointers[p][v]=parseInt(menu_top.category);for(var v=null,p=r;p<=_;p++)v=parseInt((p-i)/s),$.isNumeric(v)||(v=t),this.pointers[p][v]=parseInt(menu_top.category)}}};